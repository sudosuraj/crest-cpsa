From 1d4ae9cad916ec474e630d9f33f29c0bc449d19c Mon Sep 17 00:00:00 2001
From: Devin AI <158243242+devin-ai-integration[bot]@users.noreply.github.com>
Date: Mon, 22 Dec 2025 12:04:30 +0000
Subject: [PATCH] fix: add 'update' command to setup.yml and improve status
 page deployment

- Add 'update' command to setup.yml to create initial history/api data
- Improve static.yml to use cp -a for dotfiles and add .nojekyll
- Add helpful logging when status page is/isn't generated

The 'update' command was missing from setup.yml, which meant running
Setup CI wouldn't create the initial uptime data needed for the status page.

Co-Authored-By: mailsurajzso7+000095i349qo@gmail.com <mailsurajzso7@gmail.com>
---
 .github/workflows/setup.yml  |  7 +++++++
 .github/workflows/static.yml | 12 +++++++++++-
 2 files changed, 18 insertions(+), 1 deletion(-)

diff --git a/.github/workflows/setup.yml b/.github/workflows/setup.yml
index fa8e4e1..86c30c8 100644
--- a/.github/workflows/setup.yml
+++ b/.github/workflows/setup.yml
@@ -42,6 +42,13 @@ jobs:
           command: "update-template"
         env:
           GH_PAT: ${{ secrets.GH_PAT || github.token }}
+      - name: Check endpoint status (creates initial data)
+        uses: upptime/uptime-monitor@v1.41.0
+        with:
+          command: "update"
+        env:
+          GH_PAT: ${{ secrets.GH_PAT || github.token }}
+          SECRETS_CONTEXT: ${{ toJson(secrets) }}
       - name: Update response time
         uses: upptime/uptime-monitor@v1.41.0
         with:
diff --git a/.github/workflows/static.yml b/.github/workflows/static.yml
index 43570f6..02b6b2e 100644
--- a/.github/workflows/static.yml
+++ b/.github/workflows/static.yml
@@ -45,8 +45,18 @@ jobs:
           find . -maxdepth 1 -not -name '.' -not -name '..*' -not -name '_site' -not -name 'site' -not -name 'node_modules' -exec cp -r {} _site/ \;
           # Copy Upptime status page to /status/ subdirectory
           if [ -d "site/status-page/__sapper__/export" ]; then
+            echo "Found Upptime status page export, copying to _site/status/"
             mkdir -p _site/status
-            cp -r site/status-page/__sapper__/export/* _site/status/
+            # Use cp -a with /. to include dotfiles like .nojekyll
+            cp -a site/status-page/__sapper__/export/. _site/status/
+            # Ensure .nojekyll exists at root for underscore directories
+            touch _site/.nojekyll
+            echo "Status page files:"
+            ls -la _site/status/ | head -20
+          else
+            echo "WARNING: Upptime status page not generated (site/status-page/__sapper__/export not found)"
+            echo "This is expected if no uptime data exists yet (history/ and api/ directories)"
+            echo "Run 'Setup CI' workflow first to generate initial uptime data"
           fi
       - name: Setup Pages
         uses: actions/configure-pages@v5
-- 
2.34.1

